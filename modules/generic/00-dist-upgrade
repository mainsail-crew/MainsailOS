set -x
set -e

export LC_ALL=C
export DEBIAN_FRONTEND=noninteractive

# load common functions
source /common.sh
install_cleanup_trap

# list from all packages which should be hold during the upgrade process
PKGS=( "linux-image-*" "linux-headers-*" "linux-kbuild-*" "armbian-firmware" "raspi-firmware" "linux-dtb-*" )

# update package manager
apt-get update --allow-releaseinfo-change

# hold linux kernel updates
apt-mark hold "${PKGS[@]}" > /dev/null 2>&1 || true

# execute update
apt-get -y dist-upgrade

# clean up
apt-get -y autoremove
apt-get clean

# unhold linux kernel updates
apt-mark unhold "${PKGS[@]}" > /dev/null 2>&1 || true
